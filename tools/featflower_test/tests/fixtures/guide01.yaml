schema_version: "0.2"
id: test_guide01
name: Test Guide 01
suite: smoke
priority: normal
enabled: true

setup:
  modules: []
  git:
    submodules:
      mode: strict
      update_recursive: true

build:
  workspace: build-test
  cache_policy: reuse_if_compatible
  steps:
    - kind: cmake_configure
      build_dir: build-test
      source_dir: .
      options:
        - CMAKE_BUILD_TYPE=Release
    - kind: cmake_build
      build_dir: build-test
      targets: [q2p1_fc_ext]
      jobs: 4

run:
  levels:
    start: 2
    count: 1
    parameter_patch:
      file_in: _adc/2D_FAC/q2p1_param_2D.dat
      file_out: _data/q2p1_param.dat
      key: SimPar@MaxMeshLevel
  partition:
    tool: python
    command: "python3 {repo_root}/tools/PyPartitioner.py 3 1 1 NEWFAC _adc/2D_FAC/2Dbench.prj"
    expected_partition_count: 3
  launch:
    workdir: build-test/applications/q2p1_fc_ext
    mpi_ranks: 4
    command: "./q2p1_fc_ext"

metrics:
  - id: drag_lift
    parser: keyword_columns
    file: _data/prot.txt
    keyword: "BenchForce:"
    columns: {drag: 2, lift: 3}
    occurrence: last
    numeric_format: fortran_d_or_e
    compare:
      type: tolerance
      tolerance: {drag: 1.0e-4, lift: 1.0e-4}

references:
  baseline: tests/fixtures/baseline_guide01.yaml
